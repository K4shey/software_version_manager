### Техническое задание на проект "Система управления версиями ПО и подразделениями"

#### 1. Общий обзор проекта

##### Цель проекта
Разработать приложение для управления конфигурациями программного обеспечения и подразделениями в организации. Администраторы используют данную систему для обеспечения актуальности и управления программными конфигурациями в различных подразделениях.

##### Основные функции
- **Управление подразделениями**: Администраторы могут создавать, получать, обновлять и удалять подразделения.
- **Управление конфигурациями**: Администраторы могут создавать, получать, обновлять и удалять программные конфигурации, связанные с конкретными подразделениями.
- **Отслеживание версий**: Система позволяет отслеживать версии программного обеспечения для каждой конфигурации, обеспечивая администраторов актуальной информацией о последних обновлениях.
- **Система уведомлений**: Администраторы получают уведомления о новых версиях программного обеспечения или о необходимости обновлений конфигураций.

#### 2. Адреса ресурсов API

##### Подразделения

- **Получить список подразделений**
  - **Описание**: Возвращает список подразделений, управляемых администраторами в организации, с пагинацией.
  - **Адрес ресурса**: `GET /api/v1/departments`

- **Создать подразделение**
  - **Описание**: Позволяет администраторам создавать новое подразделение в организации.
  -  **Адрес ресурса**: `POST /api/v1/departments`

- **Получить подразделение по идентификатору**
  - **Описание**: Возвращает детали конкретного подразделения по его идентификатору.
  -  **Адрес ресурса**: `GET /api/v1/departments/{id}`

- **Обновить подразделение**
  - **Описание**: Позволяет администраторам обновлять детали конкретного подразделения.
  -  **Адрес ресурса**: `PUT /api/v1/departments/{id}`

- **Удалить подразделение**
  - **Описание**: Позволяет администраторам удалять конкретное подразделение в организации.
  - **Адрес ресурса**: `DELETE /api/v1/departments/{id}`

##### Конфигурации

- **Получить список конфигураций**
  - **Описание**: Возвращает список программных конфигураций с пагинацией.
  - **Адрес ресурса**: `GET /api/v1/configurations`

- **Создать конфигурацию**
  - **Описание**: Позволяет администраторам создавать новую программную конфигурацию для конкретного подразделения.
  - **Адрес ресурса**: `POST /api/v1/configurations`

- **Получить конфигурацию по идентификатору**
  - **Описание**: Возвращает детали конкретной программной конфигурации по её идентификатору.
  - **Адрес ресурса**: `GET /api/v1/configurations/{id}`

- **Обновить конфигурацию**
  - **Описание**: Позволяет администраторам обновлять детали конкретной программной конфигурации.
  - **Адрес ресурса**: `PUT /api/v1/configurations/{id}`

- **Удалить конфигурацию**
  - **Описание**: Позволяет администраторам удалять конкретную программную конфигурацию в организации.
  - **Адрес ресурса**: `DELETE /api/v1/configurations/{id}`

#### 3. Схемы данных

##### Таблица `Конфигурации` (Configurations)

- **configuration_id** (Primary Key)
- **configuration_name** (Наименование конфигурации)
- **current_version** (Текущая версия)
- **latest_version** (Актуальная версия)
- **department_id** (Foreign Key) (Подразделение)
- **status** (Статус конфигурации: New, Actual, Need update)
- 
##### Таблица `Подразделения` (Departments)

- **department_id** (Primary Key)
- **department_name** (Наименование подразделения)
- **parent_department_id** (Родительское подразделение)
- **head_name** (Руководитель подразделения)
- **head_phone** (Телефон руководителя)
- **head_email** (Почта руководителя)
- **note** (Примечание)

#### 4. Пользовательские сценарии

##### Сценарий 1: Создание нового подразделения

- **Актор**: Администратор
- **Основной поток**:
  1. Администратор выбирает опцию создания нового подразделения.
  2. Администратор вводит необходимые данные (название подразделения, родительское подразделение, если есть).
  3. Система сохраняет новое подразделение и отображает подтверждение.

##### Сценарий 2: Обновление подразделения

- **Актор**: Администратор
- **Предусловие**: Подразделение должно существовать.
- **Основной поток**:
  1. Администратор выбирает подразделение для обновления.
  2. Администратор вносит необходимые изменения (например, изменяет название или подчиненность).
  3. Система обновляет подразделение и отображает подтверждение.

##### Сценарий 3: Удаление подразделения

- **Актор**: Администратор
- **Предусловие**: Подразделение должно существовать.
- **Основной поток**:
  1. Администратор выбирает подразделение для удаления.
  2. Система удаляет подразделение и отображает подтверждение.

##### Сценарий 4: Создание новой конфигурации

- **Актор**: Администратор
- **Основной поток**:
  1. Администратор выбирает опцию создания новой конфигурации.
  2. Администратор вводит необходимые данные (имя конфигурации, псевдоним, текущая версия, ID подразделения).
  3. Система устанавливает значение последней версии на 1.1.1.1 и статус на `NEW`.
  4. Система сохраняет новую конфигурацию и отображает подтверждение.

##### Сценарий 5: Обновление конфигурации

- **Актор**: Администратор
- **Предусловие**: Конфигурация должна существовать.
- **Основной поток**:
  1. Администратор выбирает конфигурацию для обновления.
  2. Администратор вносит необходимые изменения (например, изменяет текущую версию).
  3. Система проверяет актуальную версию на сайте вендора.
  4. Если текущая версия меньше актуальной версии, система обновляет статус на `NEEDS_UPDATE`.
  5. Если текущая версия равна актуальной версии, система обновляет статус на `ACTUAL`.
  6. Система сохраняет обновленную информацию и отображает подтверждение.

##### Сценарий 6: Удаление конфигурации

- **Актор**: Администратор
- **Предусловие**: Конфигурация должна существовать.
- **Основной поток**:
  1. Администратор выбирает конфигурацию для удаления.
  2. Система удаляет конфигурацию и отображает подтверждение.

##### Сценарий 7: Отслеживание версии ПО для подразделения

- **Актор**: Администратор
- **Предусловие**: Подразделение должно существовать.
- **Основной поток**:
  1. Пользователь выбирает подразделение.
  2. Система отображает текущие версии ПО для выбранного подразделения.
  3. По статусам конфигураций принимается решение по обновлению версий ПО.

##### Сценарий 8: Автоматическая проверка обновлений конфигураций

- **Актор**: Система
- **Предусловие**: Конфигурации созданы и зарегистрированы в системе.
- **Основной поток**:
  1. Система по расписанию инициирует проверку обновлений для всех конфигураций.
  2. Система запрашивает через API вендора актуальные версии конфигураций.
  3. Система сравнивает текущие версии с актуальными.
  4. Если текущая версия меньше актуальной версии, система обновляет значение последней версии и устанавливает статус `NEEDS_UPDATE`.
  5. Если текущая версия равна актуальной версии, система обновляет значение последней версии и устанавливает статус `ACTUAL`.
  6. Если текущая версия больше актуальной версии, система устанавливает статус `ERROR` и отправляет сообщение об ошибке администратору в мессенджер.
  7. Система сохраняет обновленную информацию в базе данных и отправляет уведомление администратору.

#### 5. Алгоритм актуализации текущей версии конфигурации. Статусная модель.

1. Через API добавляется новая конфигурация. Указывается имя, псевдоним, текущая версия конфигурации, id подразделения. Значение последней версии по умолчанию устанавливается в 1.1.1.1, статус **NEW**.
2. По расписанию вызывается метод сервиса `checkForUpdates()`, который перебирает все существующие в базе конфигурации и последовательно проверяет для них наличие более свежей версии, по сравнению с текущей.
   2.1. Если текущая версия меньше версии, полученной на сайте, то обновляем значение последней версии, устанавливаем статус **NEED_UPDATE**. Отправляем уведомление о наличии более свежей версии.
   2.2. Если текущая версия равна версии полученной на сайте, то обновляем значение последней версии, устанавливаем статус **ACTUAL**.
   2.3 Если текущая версия больше версии, полученной на сайте - устанавливается статус **ERROR**. Такая ситуация требует вмешательства администратора. Отправляем уведомление о наличии ошибочной ситуации.
3. При изменении значения текущей версии конфигуратора через API по расписанию запускается проверка актуальной версии на сайте вендора и устанавливается статус изменённой конфигурации в соответствии с проверкой. Логика такая же как и в пункте 2.

В файле `src/main/resources/docs/ConfigurationStateDiagram.puml` представлена  диаграмма изменения статусов конфигурации в процессе работы приложения.














